<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <script defer>
      const sp = new URLSearchParams(window.location.search)
      let loc = sp.get('location');
      if (!loc) loc = prompt('Enter a MD file\'s URL:')
      const md = window.markdownit();
      (async()=>{
        // cors
        const corsres1 = await (await fetch('https://cors-anywhere.herokuapp.com/corsdemo')).text()
        if (!corsres1.includes('You currently have temporary access to the demo server.')) {
          const acrq = corsres1.split('type="hidden" name="accessRequest" value="').pop().split('"').shift()
          const corsres2 = await (await fetch("https://cors-anywhere.herokuapp.com/corsdemo?accessRequest="+acrq, {
            "headers": {
              "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8",
              "accept-language": "en-GB,en;q=0.6",
              "cache-control": "no-cache",
              "pragma": "no-cache",
              "sec-fetch-dest": "document",
              "sec-fetch-mode": "navigate",
              "sec-fetch-site": "same-origin",
              "sec-fetch-user": "?1",
              "sec-gpc": "1",
              "upgrade-insecure-requests": "1"
            },
            "referrer": "https://cors-anywhere.herokuapp.com/corsdemo",
            "referrerPolicy": "strict-origin-when-cross-origin",
            "body": null,
            "method": "GET",
            "mode": "cors",
            "credentials": "omit"
          })).text()
          if (!corsres2.includes('You currently')) alert('Please visit https://cors-anywhere.herokuapp.com/corsdemo to use this.')
        }
        // actual code
        const result = md.render(await (await fetch(loc)).text());
        console.log(result)
      })()
    </script>
  </head>
